import{d as W,e as u,o as b,v as L,w as n,g as e,m as F,r as c,u as se,a0 as Y,h as s,J as w,f as G,F as Q,q as Z,j as P,t as oe,a1 as ue,a2 as ee,a3 as re,a4 as ie,a5 as de,a6 as pe,L as q,_ as ce,S as me,y as _e,a7 as ge,V as fe,A as H,B as J,a8 as ye,a9 as ve}from"./index-7801d67b.js";const Se=["src"],xe=W({__name:"index",props:["skuList"],setup(D){return(y,k)=>{const v=u("el-table-column"),g=u("el-table");return b(),L(g,{data:D.skuList,style:{width:"100%"}},{default:n(()=>[e(v,{prop:"skuName",label:"SkuName",width:"180"}),e(v,{prop:"price",label:"SkuPrice",width:"180"}),e(v,{prop:"quantity",label:"수량(EA)"}),e(v,{label:"Image"},{default:n(({row:f})=>[F("img",{src:f.skuDefaultImg,style:{whidth:"100px",height:"100px"}},null,8,Se)]),_:1})]),_:1},8,["data"])}}}),be=W({__name:"SpuForm",emits:["changeScene"],setup(D,{expose:y,emit:k}){let v=c([]),g=k,f=c(""),S=se();c("");let A=c({}),_=c([]),o=c({id:"",spuName:"",price:0,description:"",category2Id:"",spuSaleAttrList:[],spuImageList:[]});const z=async(a,t)=>{const{data:p}=await ee();v.value=p,o.value={id:"",spuName:"",description:"",category2Id:t,spuSaleAttrList:[]}},U=async a=>{const t=await ee();v.value=t.data;const{id:p}=a,{data:d}=await re(p);o.value=d,console.log(o.value,"=========");const $=await ie(p);_.value=$.data.map(I=>({id:I.id,spuId:I.spuId,name:I.fileOriginalName,url:I.imgUrl}))},x=Y(()=>v.value.filter(a=>o.value.spuSaleAttrList.every(t=>a.attrName!=t.baseAttrName))),O=()=>{const[a,t]=f.value.split(":"),p={id:"",spuId:o.value.id,baseAttrId:a,baseAttrName:t,spuSaleAttrValueList:[],flag:!1};o.value.spuSaleAttrList.push(p),f.value=""},R=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,a=>(a==="x"?Math.random()*16|0:+"r&0x3"|+"0x8").toString(16)),E=a=>new Promise((t,p)=>{console.log("......refdfd"),de().then(d=>{A.value={policy:d.data.policy,Signature:d.data.signature,OSSAccessKeyId:d.data.accessid,key:d.data.dir+R()+a.name,dir:d.data.dir,host:d.data.host},console.log(".........",A.value),t(!0)}).catch(d=>{console.log("...err..",d),p(!1)})}),K=(a,t)=>{console.log("上传成功...",t),_.value.pop(),_.value.push({id:"",spuId:o.value.id,name:t.name,url:A.value.host+"/"+A.value.key.replace("${filename}",t.name)})},B=(a,t)=>{_.value=t},M=a=>{console.log(a),a.saleAttrValue="",a.flag=!0},i=a=>{a.flag=!1,!(a.saleAttrValue==""||a.spuSaleAttrValueList.some(p=>p.spuAttrValueName==a.saleAttrValue))&&a.spuSaleAttrValueList.push({id:"",spuId:a.spuId,spuSaleAttrId:"",spuAttrValueName:a.saleAttrValue})},r=async()=>{console.log("fileLIst",_.value),o.value.spuImageList=_.value.map(t=>({id:t.id,imgName:t.name,imgUrl:t.url,spuId:t.spuId})),(await pe(o.value)).code==200?(q({type:"success",message:o.value.id?"업데이트 완료":"SPU 추가 완료"}),g("changeScene",{flag:0,params:o.value.id?"update":"newAdd"})):q({type:"error",message:o.value.id?"업데이트 실패":"SPU 추가 실패"})},N=Y(()=>({token:S.token}));return y({addSPU:z,initSpu:U}),(a,t)=>{const p=u("el-input"),d=u("el-form-item"),$=u("Plus"),I=u("el-icon"),T=u("el-upload"),j=u("el-option"),m=u("el-select"),C=u("el-button"),V=u("el-table-column"),te=u("el-tag"),ae=u("el-table"),le=u("el-form");return b(),L(le,{"label-width":"80px"},{default:n(()=>[e(d,{label:"SPUName"},{default:n(()=>[e(p,{modelValue:s(o).spuName,"onUpdate:modelValue":t[0]||(t[0]=l=>s(o).spuName=l)},null,8,["modelValue"])]),_:1}),e(d,{label:"Price"},{default:n(()=>[e(p,{modelValue:s(o).price,"onUpdate:modelValue":t[1]||(t[1]=l=>s(o).price=l)},null,8,["modelValue"])]),_:1}),e(d,{label:"SPUDes"},{default:n(()=>[e(p,{type:"textarea",modelValue:s(o).description,"onUpdate:modelValue":t[2]||(t[2]=l=>s(o).description=l)},null,8,["modelValue"])]),_:1}),e(d,{label:"MainImage"},{default:n(()=>[e(T,{"file-list":s(_),"onUpdate:fileList":t[3]||(t[3]=l=>w(_)?_.value=l:_=l),action:"http://mee0-hello.oss-ap-northeast-2.aliyuncs.com",data:s(A),headers:N.value,"on-success":K,"list-type":"picture-card","on-remove":B,"before-upload":E,multiple:!1},{trigger:n(()=>[e(I,null,{default:n(()=>[e($)]),_:1})]),_:1},8,["file-list","data","headers"])]),_:1}),e(d,{label:"SPUSaleAttr"},{default:n(()=>[e(m,{placeholder:`${x.value.length} 개 선택가능`,modelValue:s(f),"onUpdate:modelValue":t[4]||(t[4]=l=>w(f)?f.value=l:f=l)},{default:n(()=>[(b(!0),G(Q,null,Z(x.value,l=>(b(),L(j,{key:l.id,label:l.attrName,value:`${l.id}:${l.attrName}`},null,8,["label","value"]))),128))]),_:1},8,["placeholder","modelValue"]),e(C,{type:"primary",size:"default",icon:"Plus",onClick:O,style:{"margin-left":"10px"},disabled:x.value.length==0},{default:n(()=>[P(" SPU SaleAttr 추가 ")]),_:1},8,["disabled"]),e(ae,{border:"",style:{margin:"10px 0"},data:s(o).spuSaleAttrList},{default:n(()=>[e(V,{type:"index",label:"NO",width:"80",align:"center"}),e(V,{label:"AttrName",prop:"baseAttrName",width:"100"}),e(V,{label:"AttrValue",prop:"baseAttrName"},{default:n(({row:l,$index:X})=>[(b(!0),G(Q,null,Z(l.spuSaleAttrValueList,(h,ne)=>(b(),L(te,{style:{"margin-right":"5px"},key:h.id,class:"mx-1",closable:"","disable-transitions":!1,onClose:Ae=>l.spuSaleAttrValueList.splice(ne,1)},{default:n(()=>[P(oe(h.spuAttrValueName),1)]),_:2},1032,["onClose"]))),128)),l.flag?(b(),L(p,{key:0,ref:"InputRef",size:"small",style:{width:"150px"},modelValue:l.saleAttrValue,"onUpdate:modelValue":h=>l.saleAttrValue=h,onKeyup:ue(h=>i(l),["enter"]),onBlur:h=>i(l)},null,8,["modelValue","onUpdate:modelValue","onKeyup","onBlur"])):(b(),L(C,{key:1,class:"button-new-tag ml-1",size:"small",onClick:h=>M(l)},{default:n(()=>[P(" + New Tag ")]),_:2},1032,["onClick"]))]),_:1}),e(V,{label:"비고",align:"center",width:"120"},{default:n(({row:l,$index:X})=>[e(C,{type:"danger",plain:"",size:"small",icon:"Delete",onClick:h=>s(o).spuSaleAttrList.splice(X,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(d,null,{default:n(()=>[e(C,{type:"primary",onClick:r},{default:n(()=>[P("저장")]),_:1}),e(C,{onClick:t[5]||(t[5]=l=>s(g)("changeScene",{flag:0,params:"cancel"}))},{default:n(()=>[P("취소")]),_:1})]),_:1})]),_:1})}}});const ke=ce(be,[["__scopeId","data-v-3a907531"]]),Ve=W({__name:"index",setup(D){let y=c(1),k=c(3);c();let v=c(0),g=me(),f=c([]),S=c(0),A=c(),_=c(),o=c(""),z=c([]),U=c(!1);_e(()=>g.category2Id,()=>{if(g.category2Id==""){f.value=[];return}x()});const x=async(i=1)=>{y.value=i;const{data:r}=await ge(g.category2Id,y.value,k.value);f.value=r.rows,v.value=r.total},O=i=>{S.value=2;const{category1Id:r,category2Id:N}=g;A.value.initSku(r,N,i,"addSku")},R=()=>{S.value=1;const{category1Id:i,category2Id:r}=g;_.value.addSPU(i,r)},E=i=>{S.value=1,_.value.initSpu(i)},K=async i=>{o.value=i.spuName,U.value=!0;const r=await ye(i.id);console.log(r),z.value=r.data},B=i=>{S.value=i.flag,i.params=="update"||i.params=="cancel"?x(y.value):x()},M=async i=>{let r=i.id;(await ve(r)).code==200?(q({type:"success",message:"삭제완료"}),x()):q({type:"error",message:"삭제실패"})};return fe(()=>{g.$reset()}),(i,r)=>{const N=u("Category"),a=u("el-button"),t=u("el-table-column"),p=u("el-popconfirm"),d=u("el-table"),$=u("el-pagination"),I=u("SkuForm"),T=u("el-dialog"),j=u("el-card");return b(),G(Q,null,[e(N,{scene:s(S)},null,8,["scene"]),e(j,{style:{"margin-top":"10px"}},{default:n(()=>[H(F("div",null,[e(a,{type:"primary",size:"default",icon:"Plus",onClick:R,disabled:!s(g).category2Id},{default:n(()=>[P(" SPU 추가 ")]),_:1},8,["disabled"]),e(d,{style:{margin:"10px 0"},data:s(f)},{default:n(()=>[e(t,{label:"NO",type:"index",align:"center",width:"80px"}),e(t,{label:"SPUName",align:"center",width:"150px",prop:"spuName"}),e(t,{label:"SPUDecoration",align:"center",prop:"description"}),e(t,{label:"비고",align:"center",width:"250px"},{default:n(({row:m,$index:C})=>[e(a,{type:"primary",plain:"",size:"small",icon:"Plus",onClick:V=>O(m)},null,8,["onClick"]),e(a,{type:"primary",plain:"",size:"small",icon:"Edit",onClick:V=>E(m)},null,8,["onClick"]),e(a,{type:"primary",plain:"",size:"small",icon:"View",onClick:V=>K(m)},null,8,["onClick"]),e(p,{title:"`을/를 삭제하겠습니까?`",onConfirm:V=>M(m)},{reference:n(()=>[e(a,{type:"danger",plain:"",size:"small",icon:"Delete"})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),e($,{"current-page":s(y),"onUpdate:currentPage":r[0]||(r[0]=m=>w(y)?y.value=m:y=m),"page-size":s(k),"onUpdate:pageSize":r[1]||(r[1]=m=>w(k)?k.value=m:k=m),layout:" prev, pager, next,jumper,->,sizes, total",total:s(v),"page-sizes":[3,5,7,10],onSizeChange:x,onCurrentChange:r[2]||(r[2]=m=>x(s(y)))},null,8,["current-page","page-size","total"])],512),[[J,s(S)==0]]),H(F("div",null,[e(ke,{onChangeScene:B,ref_key:"spuForm",ref:_},null,512)],512),[[J,s(S)==1]]),H(F("div",null,[e(I,{onChangeScene:B,ref_key:"skuForm",ref:A},null,512)],512),[[J,s(S)==2]]),e(T,{title:`${s(o)}的sku列表`,modelValue:s(U),"onUpdate:modelValue":r[3]||(r[3]=m=>w(U)?U.value=m:U=m),"before-close":i.close},{default:n(()=>[e(xe,{skuList:s(z)},null,8,["skuList"])]),_:1},8,["title","modelValue","before-close"])]),_:1})],64)}}});export{Ve as default};
