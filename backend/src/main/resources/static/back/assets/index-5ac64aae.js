import{d as G,e as r,o as S,v as C,w as a,g as e,m as J,Q as w,a as re,r as m,y as ue,f as D,h as n,F,q as O,j as q,U as de,L as M,u as ie,Y as le,J as Q,t as pe,Z as ce,_ as me,S as _e,V as ge,A as W,B as X}from"./index-06005ebc.js";import{c as fe,d as ve}from"./index-dc245eb4.js";const ye=["src"],Se=G({__name:"index",props:["skuList"],setup(y){return(b,L)=>{const I=r("el-table-column"),o=r("el-table");return S(),C(o,{data:y.skuList,style:{width:"100%"}},{default:a(()=>[e(I,{prop:"skuName",label:"SkuName",width:"180"}),e(I,{prop:"price",label:"SkuPrice",width:"180"}),e(I,{prop:"quantity",label:"수량(EA)"}),e(I,{label:"Image"},{default:a(({row:g})=>[J("img",{src:g.skuDefaultImg,style:{whidth:"100px",height:"100px"}},null,8,ye)]),_:1})]),_:1},8,["data"])}}}),Ve=(y,b,L)=>w({url:`/admin/product/getSpuList/${b}/${L}`,params:{category2Id:y},method:"get"}),ae=()=>w.get("/admin/product/baseSaleAttrList"),be=y=>w.get(`/admin/product/getSpuById/${y}`),Ae=y=>y.id?w({url:"/admin/product/updateSpuInfo",method:"put",data:y}):w({url:"/admin/product/saveSpuInfo",method:"post",data:y}),Ie=y=>w.get(`/admin/product/spuSaleAttrList/${y}`),ke=y=>w({url:`/admin/product/deleteSpu/${y}`,method:"delete"}),se=y=>w.get(`/admin/product/getSpuImageList/${y}`),xe=()=>w.get("/oss/policy"),he=["src"],Le=G({__name:"SkuForm",emits:["changeScene"],setup(y,{expose:b,emit:L}){let I=L,o=re({id:"",spuId:"",quantity:"",price:0,skuName:"",category2Id:"",skuDefaultImg:"",discount:"",decoration:"",skuAttrValueList:[],skuSaleAttrValueList:[]});const g=m();let k=m(),x=m([]),v=m([]),i=m([]),B=m();m();const $=async(l,t,u)=>{B.value=u.spuName,o.price=u.price,o.spuId=u.id,o.category2Id=t;const s=await Ie(u.id);s.code==200&&(x.value=s.data);const V=await de(l,t);V.code==200&&(v.value=V.data);const h=await se(u.id);i.value=h.data};ue([()=>x.value,()=>v.value],([l,t])=>{const u=l.every(V=>V.saleAttrIdAandValueId),s=t.every(V=>V.attrIdAndValueId);u&&(g.value.clearValidate(["skuSaleAttrValueList"]),T()),s&&(g.value.clearValidate(["skuAttrValueList"]),N())},{deep:!0});const N=()=>{o.skuAttrValueList=v.value.reduce((l,t)=>{if(t.attrIdAndValueId){console.log(t,"--------next");const[u,s]=t.attrIdAndValueId.split(":");return l.push({attrId:s,valueId:u}),l}},[])},T=()=>{o.skuSaleAttrValueList=x.value.map(l=>{console.log(l.saleAttrIdAandValueId,"-------");const[t,u]=l.saleAttrIdAandValueId.split(":");return{saleAttrId:u,saleValueId:t}})},j={skuName:[{required:!0},{min:3,message:"Length should be 3 ",trigger:"blur"}],decoration:[{required:!0},{min:10,message:"Length should be 10",trigger:"blur"}],quantity:[{required:!0},{min:1,message:"최소1개",trigger:"blur"}],attrName:[{required:!0}],discount:[{required:!0}],skuDefaultImg:[{required:!0}],skuSaleAttrValueList:[{required:!0},{validator:(l,t,u)=>{t?g.value.clearValidate(["skuSaleAttrValueList"]):u(new Error("Please input the skuSaleAttrValueList")),u()},trigger:"blur"}],skuAttrValueList:[{required:!0},{validator:(l,t,u)=>{t?g.value.clearValidate(["skuAttrValueList"]):u(new Error("Please input the attrValue")),u()},trigger:"blur"}]},R=()=>{g.value.clearValidate()},H=l=>{console.log(l),k.value.clearSelection(),k.value.toggleRowSelection(l,!0),o.skuDefaultImg=l.imgUrl},_=()=>{Object.assign(o,{id:"",spuId:"",quantity:"",price:0,skuName:"",category2Id:"",skuDefaultImg:"",discount:"",decoration:"",skuAttrValueList:[],skuSaleAttrValueList:[]})},c=async()=>{if(!g.value)return;try{await g.value.validate()}catch{return console.log("빈칸 채우세요"),!1}g.value.resetFields(),(await fe(o)).code==200?(M({type:"success",message:"SKU 추가 완료"}),_(),I("changeScene",{flag:0,params:"update"})):M({type:"error",message:"SKU 추가 실패"})},P=()=>{R(),I("changeScene",{flag:0,params:"cancel"})};return b({initSku:$}),(l,t)=>{const u=r("el-input"),s=r("el-form-item"),V=r("el-form"),h=r("el-option"),E=r("el-select"),f=r("el-table-column"),K=r("el-button"),U=r("el-table");return S(),D(F,null,[e(V,{"label-width":"100px"},{default:a(()=>[e(s,{label:"spuName"},{default:a(()=>[e(u,{value:n(B),disabled:""},null,8,["value"])]),_:1})]),_:1}),e(V,{model:n(o),"label-width":"100px",rules:j,ref_key:"ruleFormRef",ref:g},{default:a(()=>[e(s,{label:"skuName",prop:"skuName"},{default:a(()=>[e(u,{modelValue:n(o).skuName,"onUpdate:modelValue":t[0]||(t[0]=p=>n(o).skuName=p),placeholder:"네임"},null,8,["modelValue"])]),_:1}),e(s,{label:"price",prop:"price"},{default:a(()=>[e(u,{value:n(o).price,placeholder:"price(원)",disabled:""},null,8,["value"])]),_:1}),e(s,{label:"skuDes",prop:"decoration"},{default:a(()=>[e(u,{modelValue:n(o).decoration,"onUpdate:modelValue":t[1]||(t[1]=p=>n(o).decoration=p),type:"textarea",placeholder:"내용"},null,8,["modelValue"])]),_:1}),e(s,{label:"stockNum(EA)",prop:"quantity"},{default:a(()=>[e(u,{modelValue:n(o).quantity,"onUpdate:modelValue":t[2]||(t[2]=p=>n(o).quantity=p),placeholder:"수량"},null,8,["modelValue"])]),_:1}),e(s,{label:"Discount(%)",prop:"discount"},{default:a(()=>[e(u,{modelValue:n(o).discount,"onUpdate:modelValue":t[3]||(t[3]=p=>n(o).discount=p),placeholder:"할인"},null,8,["modelValue"])]),_:1}),e(s,{label:"속성",prop:"skuAttrValueList"},{default:a(()=>[e(V,{inline:!0},{default:a(()=>[(S(!0),D(F,null,O(n(v),p=>(S(),C(s,{label:p.attrName},{default:a(()=>[e(E,{placeholder:"please select your zone",modelValue:p.attrIdAndValueId,"onUpdate:modelValue":A=>p.attrIdAndValueId=A},{default:a(()=>[(S(!0),D(F,null,O(p.attrValueList,A=>(S(),C(h,{value:`${A.id}:${A.attrId}`,label:A.valueName},null,8,["value","label"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),256))]),_:1})]),_:1}),e(s,{label:"SpuSaleAttr",prop:"skuSaleAttrValueList"},{default:a(()=>[e(V,{inline:!0},{default:a(()=>[(S(!0),D(F,null,O(n(x),p=>(S(),C(s,{label:p.baseAttrName},{default:a(()=>[e(E,{placeholder:"please select your zone",modelValue:p.saleAttrIdAandValueId,"onUpdate:modelValue":A=>p.saleAttrIdAandValueId=A},{default:a(()=>[(S(!0),D(F,null,O(p.spuSaleAttrValueList,A=>(S(),C(h,{value:`${A.id}:${A.spuSaleAttrId}`,label:A.spuAttrValueName},null,8,["value","label"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),256))]),_:1})]),_:1}),e(s,{label:"imageName",prop:"skuDefaultImg"},{default:a(()=>[e(U,{data:n(i),border:"",style:{width:"100%"},ref_key:"tableRef",ref:k},{default:a(()=>[e(f,{type:"selection",width:"55",align:"center"}),e(f,{label:"img"},{default:a(({row:p,$index:A})=>[J("img",{src:p.imgUrl,style:{width:"100px",height:"100px"}},null,8,he)]),_:1}),e(f,{label:"ImgName",prop:"imgName",width:"160",align:"center"}),e(f,{label:"비고",width:"160",align:"center"},{default:a(({row:p,$index:A})=>[e(K,{type:"primary",size:"small",onClick:ee=>H(p)},{default:a(()=>[q(" setDefaultImage")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(s,null,{default:a(()=>[e(K,{type:"primary",onClick:c},{default:a(()=>[q("저장하기")]),_:1}),e(K,{onClick:P},{default:a(()=>[q("Cancel")]),_:1})]),_:1})]),_:1},8,["model"])],64)}}}),Ne=G({__name:"SpuForm",emits:["changeScene"],setup(y,{expose:b,emit:L}){let I=m([]),o=L,g=m(""),k=ie();m("");let x=m({}),v=m([]),i=m({id:"",spuName:"",price:0,description:"",category2Id:"",spuSaleAttrList:[],spuImageList:[]});const B=async(l,t)=>{const{data:u}=await ae();I.value=u,i.value={id:"",spuName:"",description:"",category2Id:t,spuSaleAttrList:[]}},$=async l=>{const t=await ae();I.value=t.data;const{id:u}=l,{data:s}=await be(u);i.value=s,console.log(i.value,"=========");const V=await se(u);v.value=V.data.map(h=>({id:h.id,spuId:h.spuId,name:h.fileOriginalName,url:h.imgUrl}))},N=le(()=>I.value.filter(l=>i.value.spuSaleAttrList.every(t=>l.attrName!=t.baseAttrName))),T=()=>{const[l,t]=g.value.split(":"),u={id:"",spuId:i.value.id,baseAttrId:l,baseAttrName:t,spuSaleAttrValueList:[],flag:!1};i.value.spuSaleAttrList.push(u),g.value=""},Y=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,l=>(l==="x"?Math.random()*16|0:+"r&0x3"|+"0x8").toString(16)),Z=l=>new Promise((t,u)=>{console.log("......refdfd"),xe().then(s=>{x.value={policy:s.data.policy,Signature:s.data.signature,OSSAccessKeyId:s.data.accessid,key:s.data.dir+Y()+l.name,dir:s.data.dir,host:s.data.host},console.log(".........",x.value),t(!0)}).catch(s=>{console.log("...err..",s),u(!1)})}),j=(l,t)=>{console.log("上传成功...",t),v.value.pop(),v.value.push({id:"",spuId:i.value.id,name:t.name,url:x.value.host+"/"+x.value.key.replace("${filename}",t.name)})},R=(l,t)=>{v.value=t},H=l=>{console.log(l),l.saleAttrValue="",l.flag=!0},_=l=>{l.flag=!1,!(l.saleAttrValue==""||l.spuSaleAttrValueList.some(u=>u.spuAttrValueName==l.saleAttrValue))&&l.spuSaleAttrValueList.push({id:"",spuId:l.spuId,spuSaleAttrId:"",spuAttrValueName:l.saleAttrValue})},c=async()=>{console.log("fileLIst",v.value),i.value.spuImageList=v.value.map(t=>({id:t.id,imgName:t.name,imgUrl:t.url,spuId:t.spuId})),(await Ae(i.value)).code==200?(M({type:"success",message:i.value.id?"업데이트 완료":"SPU 추가 완료"}),o("changeScene",{flag:0,params:i.value.id?"update":"newAdd"})):M({type:"error",message:i.value.id?"업데이트 실패":"SPU 추가 실패"})},P=le(()=>({token:k.token}));return b({addSPU:B,initSpu:$}),(l,t)=>{const u=r("el-input"),s=r("el-form-item"),V=r("Plus"),h=r("el-icon"),E=r("el-upload"),f=r("el-option"),K=r("el-select"),U=r("el-button"),p=r("el-table-column"),A=r("el-tag"),ee=r("el-table"),ne=r("el-form");return S(),C(ne,{"label-width":"80px"},{default:a(()=>[e(s,{label:"SPUName"},{default:a(()=>[e(u,{modelValue:n(i).spuName,"onUpdate:modelValue":t[0]||(t[0]=d=>n(i).spuName=d)},null,8,["modelValue"])]),_:1}),e(s,{label:"Price"},{default:a(()=>[e(u,{modelValue:n(i).price,"onUpdate:modelValue":t[1]||(t[1]=d=>n(i).price=d)},null,8,["modelValue"])]),_:1}),e(s,{label:"SPUDes"},{default:a(()=>[e(u,{type:"textarea",modelValue:n(i).description,"onUpdate:modelValue":t[2]||(t[2]=d=>n(i).description=d)},null,8,["modelValue"])]),_:1}),e(s,{label:"MainImage"},{default:a(()=>[e(E,{"file-list":n(v),"onUpdate:fileList":t[3]||(t[3]=d=>Q(v)?v.value=d:v=d),action:"http://mee0-hello.oss-ap-northeast-2.aliyuncs.com",data:n(x),headers:P.value,"on-success":j,"list-type":"picture-card","on-remove":R,"before-upload":Z,multiple:!1},{trigger:a(()=>[e(h,null,{default:a(()=>[e(V)]),_:1})]),_:1},8,["file-list","data","headers"])]),_:1}),e(s,{label:"SPUSaleAttr"},{default:a(()=>[e(K,{placeholder:`${N.value.length} 개 선택가능`,modelValue:n(g),"onUpdate:modelValue":t[4]||(t[4]=d=>Q(g)?g.value=d:g=d)},{default:a(()=>[(S(!0),D(F,null,O(N.value,d=>(S(),C(f,{key:d.id,label:d.attrName,value:`${d.id}:${d.attrName}`},null,8,["label","value"]))),128))]),_:1},8,["placeholder","modelValue"]),e(U,{type:"primary",size:"default",icon:"Plus",onClick:T,style:{"margin-left":"10px"},disabled:N.value.length==0},{default:a(()=>[q(" SPU SaleAttr 추가 ")]),_:1},8,["disabled"]),e(ee,{border:"",style:{margin:"10px 0"},data:n(i).spuSaleAttrList},{default:a(()=>[e(p,{type:"index",label:"NO",width:"80",align:"center"}),e(p,{label:"AttrName",prop:"baseAttrName",width:"100"}),e(p,{label:"AttrValue",prop:"baseAttrName"},{default:a(({row:d,$index:te})=>[(S(!0),D(F,null,O(d.spuSaleAttrValueList,(z,oe)=>(S(),C(A,{style:{"margin-right":"5px"},key:z.id,class:"mx-1",closable:"","disable-transitions":!1,onClose:Ce=>d.spuSaleAttrValueList.splice(oe,1)},{default:a(()=>[q(pe(z.spuAttrValueName),1)]),_:2},1032,["onClose"]))),128)),d.flag?(S(),C(u,{key:0,ref:"InputRef",size:"small",style:{width:"150px"},modelValue:d.saleAttrValue,"onUpdate:modelValue":z=>d.saleAttrValue=z,onKeyup:ce(z=>_(d),["enter"]),onBlur:z=>_(d)},null,8,["modelValue","onUpdate:modelValue","onKeyup","onBlur"])):(S(),C(U,{key:1,class:"button-new-tag ml-1",size:"small",onClick:z=>H(d)},{default:a(()=>[q(" + New Tag ")]),_:2},1032,["onClick"]))]),_:1}),e(p,{label:"비고",align:"center",width:"120"},{default:a(({row:d,$index:te})=>[e(U,{type:"danger",plain:"",size:"small",icon:"Delete",onClick:z=>n(i).spuSaleAttrList.splice(te,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(s,null,{default:a(()=>[e(U,{type:"primary",onClick:c},{default:a(()=>[q("저장")]),_:1}),e(U,{onClick:t[5]||(t[5]=d=>n(o)("changeScene",{flag:0,params:"cancel"}))},{default:a(()=>[q("취소")]),_:1})]),_:1})]),_:1})}}});const Ue=me(Ne,[["__scopeId","data-v-3a907531"]]),we=G({__name:"index",setup(y){let b=m(1),L=m(3);m();let I=m(0),o=_e(),g=m([]),k=m(0),x=m(),v=m(),i=m(""),B=m([]),$=m(!1);ue(()=>o.category2Id,()=>{if(o.category2Id==""){g.value=[];return}N()});const N=async(_=1)=>{b.value=_;const{data:c}=await Ve(o.category2Id,b.value,L.value);g.value=c.rows,I.value=c.total},T=_=>{k.value=2;const{category1Id:c,category2Id:P}=o;x.value.initSku(c,P,_)},Y=()=>{k.value=1;const{category1Id:_,category2Id:c}=o;v.value.addSPU(_,c)},Z=_=>{k.value=1,v.value.initSpu(_)},j=async _=>{i.value=_.spuName,$.value=!0;const c=await ve(_.id);console.log(c),B.value=c.data},R=_=>{k.value=_.flag,_.params=="update"||_.params=="cancel"?N(b.value):N()},H=async _=>{let c=_.id;(await ke(c)).code==200?(M({type:"success",message:"삭제완료"}),N()):M({type:"error",message:"삭제실패"})};return ge(()=>{o.$reset()}),(_,c)=>{const P=r("Category"),l=r("el-button"),t=r("el-table-column"),u=r("el-popconfirm"),s=r("el-table"),V=r("el-pagination"),h=r("el-dialog"),E=r("el-card");return S(),D(F,null,[e(P,{scene:n(k)},null,8,["scene"]),e(E,{style:{"margin-top":"10px"}},{default:a(()=>[W(J("div",null,[e(l,{type:"primary",size:"default",icon:"Plus",onClick:Y,disabled:!n(o).category2Id},{default:a(()=>[q(" SPU 추가 ")]),_:1},8,["disabled"]),e(s,{style:{margin:"10px 0"},data:n(g)},{default:a(()=>[e(t,{label:"NO",type:"index",align:"center",width:"80px"}),e(t,{label:"SPUName",align:"center",width:"150px",prop:"spuName"}),e(t,{label:"SPUDecoration",align:"center",prop:"description"}),e(t,{label:"비고",align:"center",width:"250px"},{default:a(({row:f,$index:K})=>[e(l,{type:"primary",plain:"",size:"small",icon:"Plus",onClick:U=>T(f)},null,8,["onClick"]),e(l,{type:"primary",plain:"",size:"small",icon:"Edit",onClick:U=>Z(f)},null,8,["onClick"]),e(l,{type:"primary",plain:"",size:"small",icon:"View",onClick:U=>j(f)},null,8,["onClick"]),e(u,{title:"`을/를 삭제하겠습니까?`",onConfirm:U=>H(f)},{reference:a(()=>[e(l,{type:"danger",plain:"",size:"small",icon:"Delete"})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),e(V,{"current-page":n(b),"onUpdate:currentPage":c[0]||(c[0]=f=>Q(b)?b.value=f:b=f),"page-size":n(L),"onUpdate:pageSize":c[1]||(c[1]=f=>Q(L)?L.value=f:L=f),layout:" prev, pager, next,jumper,->,sizes, total",total:n(I),"page-sizes":[3,5,7,10],onSizeChange:N,onCurrentChange:c[2]||(c[2]=f=>N(n(b)))},null,8,["current-page","page-size","total"])],512),[[X,n(k)==0]]),W(J("div",null,[e(Ue,{onChangeScene:R,ref_key:"spuForm",ref:v},null,512)],512),[[X,n(k)==1]]),W(J("div",null,[e(Le,{onChangeScene:R,ref_key:"skuForm",ref:x},null,512)],512),[[X,n(k)==2]]),e(h,{title:`${n(i)}的sku列表`,modelValue:n($),"onUpdate:modelValue":c[3]||(c[3]=f=>Q($)?$.value=f:$=f),"before-close":_.close},{default:a(()=>[e(Se,{skuList:n(B)},null,8,["skuList"])]),_:1},8,["title","modelValue","before-close"])]),_:1})],64)}}});export{we as default};
