import{r as le,a as te,b as ae}from"./index-cdb1d550.js";import{Q as S,d as oe,r as i,D as se,e as u,I as ne,o as C,f as re,g as l,w as a,h as n,J as b,j as c,A as V,v as z,m as q,F as de,z as ie,L as w,p as ue,k as ce,_ as pe}from"./index-7801d67b.js";import{u as me}from"./setting-72b37cf5.js";const fe=(r,p,_)=>S({url:`/admin/user/getAllRoles/${r}/${p}`,method:"get",params:{keyword:_}}),_e=r=>(console.log(r,"--------"),r.id?S({url:"/admin/user/updateRole",method:"put",data:r}):S({url:"/admin/user/saveRole",method:"post",data:r})),ve=r=>S.delete("/admin/user/deleteRole",{data:r}),ge=r=>(ue("data-v-f9a44296"),r=r(),ce(),r),ye={class:"dialog-footer"},ke=ge(()=>q("h4",null,"권한 분배",-1)),be={style:{flex:"auto"}},he=oe({__name:"index",setup(r){let p=i(1),_=i(5),B=i(0),f=i(!1),v=i(""),I=i([]),m=i(!1),D=i(""),g=i([]);const x=i();let d=i({id:"",name:"",createTime:"",updateTime:""});const j={children:"children",label:"name"};let T=i([]);const F=async()=>{const o=await ae();T.value=o.data},K=async o=>{console.log(g.value,"=========selectedArr"),d.value=o,T.value.length==0&&F();const e=await le(d.value.id);e.code==200&&(g.value=e.data,f.value=!0,ie(()=>{x.value.setCheckedKeys(g.value,!0)}))};let N=me();se(()=>{y()});const y=async(o=1)=>{p.value=o;const e=await fe(p.value,_.value,v.value);e.code==200&&(I.value=e.data.rows,B.value=e.data.total)},M=()=>{y(),v.value=""},A=()=>{N.refresh=!N.refresh},P=o=>{D.value=o.id?"업데이트":"새로운 역할 추가하기",o.id?d.value=o:d.value=[],m.value=!0,console.log("role",row)},J=async()=>{if(O())return w({type:"error",message:"roleName 중복"}),d.value.name="",!1;(await _e(d.value)).code==200&&(w({type:"success",message:d.value.id?"업데이트 성공":"새로운 ROLE 추가완료"}),y(),m.value=!1)},O=()=>I.value.some(o=>{if(d.value.id!=o.id)return o.name==d.value.name}),Q=async o=>{(await ve(o)).code==200?(w({type:"success",message:"삭제성공"}),y()):w({type:"error",message:"삭제실패"})},G=async()=>{const o=x.value.getCheckedNodes(!1,!0);x.value.getCheckedKeys(!0);let e=d.value.id;console.log("data",o);const h=o.map(s=>{if(s.pId!=0)return{id:"",r_id:e,p_id:s.id,p_name:s.name,type:s.type,code:s.code,level:s.level}});console.log("resultData",h),(await te(e,h)).code==200&&(f.value=!1,w({type:"success",message:"권한설정성공"}),A())},L=()=>{console.log(g.value,"============="),g.value=[],f.value=!1};return(o,e)=>{const h=u("el-input"),U=u("el-form-item"),s=u("el-button"),H=u("el-form"),E=u("el-card"),k=u("el-table-column"),W=u("el-table"),X=u("el-pagination"),Y=u("el-dialog"),Z=u("el-tree"),ee=u("el-drawer"),R=ne("has");return C(),re(de,null,[l(E,{style:{height:"80px"}},{default:a(()=>[l(H,{inline:!0,class:"form"},{default:a(()=>[l(U,{label:"userName"},{default:a(()=>[l(h,{placeholder:"유저네임 입력하세요",modelValue:n(v),"onUpdate:modelValue":e[0]||(e[0]=t=>b(v)?v.value=t:v=t)},null,8,["modelValue"])]),_:1}),l(U,null,{default:a(()=>[l(s,{onClick:M,disabled:!n(v)},{default:a(()=>[c("Search")]),_:1},8,["disabled"]),l(s,{type:"primary",plain:"",onClick:A},{default:a(()=>[c("reset")]),_:1})]),_:1})]),_:1})]),_:1}),l(E,{style:{margin:"10px 0px"}},{default:a(()=>[V((C(),z(s,{type:"primary",plain:"",size:"default",onClick:P},{default:a(()=>[c("역할 추가")]),_:1})),[[R,"btn.Role.add"]]),l(W,{style:{margin:"10px 0px"},data:n(I),border:""},{default:a(()=>[l(k,{label:"#",align:"center",width:"80",type:"index"}),l(k,{label:"id",align:"center",width:"80",prop:"id"}),l(k,{label:"유저 역할",align:"center",width:"100",prop:"name"}),l(k,{label:"createTime",align:"center",prop:"createTime","show-overflow-tooltip":""}),l(k,{label:"updateTime",align:"center",prop:"updateTime","show-overflow-tooltip":""}),l(k,{label:"비고",align:"center",width:"260px"},{default:a(({row:t})=>[V((C(),z(s,{icon:"User",size:"small",type:"primary",onClick:$=>K(t)},{default:a(()=>[c("권한분배")]),_:2},1032,["onClick"])),[[R,"btn.Role.assgin"]]),V((C(),z(s,{icon:"Edit",size:"small",type:"success",onClick:$=>P(t)},{default:a(()=>[c("편집")]),_:2},1032,["onClick"])),[[R,"btn.Role.update"]]),V((C(),z(s,{icon:"Delete",size:"small",type:"danger",onClick:$=>Q(t)},{default:a(()=>[c("삭제")]),_:2},1032,["onClick"])),[[R,"btn.Role.remove"]])]),_:1})]),_:1},8,["data"]),l(X,{"current-page":n(p),"onUpdate:currentPage":e[1]||(e[1]=t=>b(p)?p.value=t:p=t),"page-size":n(_),"onUpdate:pageSize":e[2]||(e[2]=t=>b(_)?_.value=t:_=t),layout:" prev, pager, next,jumper,->,sizes, total",total:n(B),"page-sizes":[3,5,7,10],onSizeChange:e[3]||(e[3]=t=>y(n(p))),onCurrentChange:y},null,8,["current-page","page-size","total"]),l(Y,{modelValue:n(m),"onUpdate:modelValue":e[6]||(e[6]=t=>b(m)?m.value=t:m=t),title:n(D),width:"500","before-close":L},{footer:a(()=>[q("div",ye,[l(s,{onClick:e[5]||(e[5]=t=>b(m)?m.value=!1:m=!1)},{default:a(()=>[c("Cancel")]),_:1}),l(s,{type:"primary",onClick:J,disabled:!n(d).name},{default:a(()=>[c(" Confirm ")]),_:1},8,["disabled"])])]),default:a(()=>[l(h,{placeholder:"역할을 추가하세요",modelValue:n(d).name,"onUpdate:modelValue":e[4]||(e[4]=t=>n(d).name=t)},null,8,["modelValue"])]),_:1},8,["modelValue","title"]),l(ee,{modelValue:n(f),"onUpdate:modelValue":e[8]||(e[8]=t=>b(f)?f.value=t:f=t),"before-close":L},{header:a(()=>[ke]),default:a(()=>[l(Z,{ref_key:"treeRef",ref:x,data:n(T),"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":n(g),props:j},null,8,["data","default-checked-keys"])]),footer:a(()=>[q("div",be,[l(s,{onClick:e[7]||(e[7]=t=>n(f)==!1)},{default:a(()=>[c("cancel")]),_:1}),l(s,{type:"primary",onClick:G},{default:a(()=>[c("confirm")]),_:1})])]),_:1},8,["modelValue"])]),_:1})],64)}}});const Re=pe(he,[["__scopeId","data-v-f9a44296"]]);export{Re as default};
